<head>
    <title>News Recommendations</title>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!------ Include the above in your HEAD tag ---------->
	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
        crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous"/>
	<link rel="stylesheet" type="text/css" href="pennbook.css"/>
</head>

<script>
	var articlesOnClient = [];
	
	function initNewsPage() {
		// TODO: ACTUALLY DISPLAY ARTICLES ON THE NEWS PAGE SOMEHOW
	
		// iterate through all of the articles
		<% articles.forEach(article => { %>
	
			// TODO: HERE IS WHERE YOU SHOULD WRITE CODE THAT INITIALLY DISPLAYS EVERY ARTICLE
			//<!-- TODO: Show the news article recommendations (use AJAX for hourly updates) -->
			// Article recommendations go here
	
			// add each article from the server into the list of articles stored on the client side
			articlesOnClient.push("<%=article%>");
		<% }) %>
	}
	
	// automatic refresh every 1 hour to update the news page
	var refreshTime = function() {
		// set clock to refresh every 5000 ms (TODO: CHANGE THIS TO ONE HOUR AFTER IT WORKS)
		$("#clock").html((new Date()).toString());
		setTimeout(refreshTime, 5000);
		// make AJAX call to get the news articles and compare the data from the server to the data on the client
		$.ajax({
				url: "/newsfeedupdate",
				type: "GET",
				success: function(data) {
					// list containing the differences between the server and client
					var newArticles = [];
						
					// iterate through data (articles) sent from server
					data.forEach(a => {
						// put the article in the list if it's from the server but not on the client
						if (!articlesOnClient.includes(a)) {
							newArticles.push(a);
							// update the client-side list to contain new articles from the server
							articlesOnClient.push(a);
						}
					});
						
					// TODO: ACTUALLY DISPLAY THE NEW ARTICLES THAT THE SERVER HAS SENT TO THE CLIENT
					newArticles.forEach(newArticle => {
						// SEE ABOVE
						alert("AJAX test " + newArticle);
					});
				},
				error: function(err) {
					// TODO: HANDLE ERRORS WITH AJAX CALLING DATABASE
					alert(err);
				}
			})
	};
	
	$(document).ready(function() {
		// CAN CHANGE CSS CODE (THE LINE BELOW) IF THERE ARE CONFLICTS
		$("#clock").css("color", "white");
		setTimeout(refreshTime, 5000);
	});
	
</script>

<body>
	<!--Top Header bar: Title of page, Toolbar, Search bar-->
	<nav class="navbar">
		<!--Title-->
		<a href="/home" class="navbar-brand" style="font-size:36px">PennBook</a>
		<!--Toolbar-->
		<div class="toolbar-container">
			<a class="button" href="/home" role="button">
				Home
			</a>
			<a class="button" href="/wall?wallToVisit=<%=username%>" role="button">
				My Wall
			</a>
			<a class="button" href="/settings" role="button">
				Settings
			</a>
			<a class="button" href="/news" role="button">
				News
			</a>
			<a class="button" href="/logout" role="button">
				Log Out
			</a>
		</div>
		<!-- News Search Bar-->
		<form action="/searchnews" method="post" class="form-inline">
			<div class="input-group">
				<label for="keyword"><font color="white">Search for an article:&nbsp</font></label>
				<input type="text" name="keyword" required class="form-control" aria-describedby="button-addon2">
				<div class="input-group-append">
					<button class="btn btn-outline-primary" type="submit" id="button-addon2">
						<i class="fa fa-search"></i>
					</button>
				</div>
			</div>
		</form>
	</nav>
</body>