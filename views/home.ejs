<!--
	HOME PAGE EJS
	Variables Used:
    - username
    Pages linked:
    - wall.ejs
    - logout

    FOR FUTURE REFERENCE IN CHANGING COLOR SCHEME
    style="background-color: #303030; border:1px solid #303030"
-->

<head>
    <title>Pennbook</title>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!------ Include the above in your HEAD tag ---------->
	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
        crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous"/>
	<link rel="stylesheet" type="text/css" href="pennbook.css"/>
</head>
        
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

<!-- Display the current time in 5 second intervals (initially black text, hidden on page) -->
<div id="clock"><center><font color="black">Please wait 5 seconds for the time to appear.</font></center></div><br></br>

<body>
<!--Top Header bar: Title of page, Toolbar, Search bar-->      
<nav class="navbar">
	<!--Title-->
	<a href="/home" class="navbar-brand" style="font-size:36px; color:#93FFDD">PennBook</a>
	<!--Toolbar-->
	<div class="toolbar-container">
        <a class="button" href="/home" role="button">
            Home
        </a>
        <a class="button" href="/wall?wallToVisit=<%=username%>" role="button">
            My Wall
        </a>
        <a class="button" href="/settings" role="button">
            Settings
        </a>
        <a class="button" href="/news" role="button">
            News
        </a>
        <a class="button" href="/logout" role="button">
			Log Out
		</a>
    </div>
	<!--Search Bar-->
	<form class="form-inline">
		<div class="input-group">
			<input type="text" class="form-control" aria-label="Recipient's username" aria-describedby="button-addon2">
			<div class="input-group-append">
				<button class="btn btn-outline-primary" type="button" id="button-addon2" style="color:#535353">
					<i class="fa fa-search"></i>
				</button>
			</div>
		</div>
	</form>
 </nav>


    <div class="container-fluid gedf-wrapper">
        <div class="row">

            <!--Left col-->
            <div class="col-md-3">
                <div class="card" >
                    <div class="card-body">
                        <!--Links to the wall-->
                        <a href="/wall?wallToVisit=<%=username%>" class="h5">@<%=username%></a>
                        <div class="h7 text-muted" >Fullname : FULL NAME</div>
                        <div class="h7"> BIO GOES HERE</div>
                    </div>
                </div>
                <br>
            </div>

            <!--Center posts col-->
            <div class="col-md-6 gedf-main">
                <!--- \\\\\\\Post-->
                <div class="card gedf-card">
                    <div class="card-header" style="font-size:20px">
                        Make a Post
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="myTabContent">
                           <div class="tab-pane fade show active" id="posts" role="tabpanel" aria-labelledby="posts-tab">
                               <form action="/postonwall" method="post">
                                <div class="form-group">
                                    <label class="sr-only" for="message">post</label>
                                    <textarea class="form-control" name="content" rows="3" placeholder="What's on your mind, <%=username%>?" required></textarea>
                                    <br>
                                    <input type="hidden" name="currentWall" value="<%=username%>">
                                    <input type="hidden" name="posterID" value="<%=username%>">
                                    
                                    <input type="hidden" name="friend" value="false">
                                    <input type="submit" value="Post" class="btn btn-lg btn-primary btn-block">
                                </div>
                               </form>
                           </div>
                            
                        </div>
                        <div class="btn-toolbar justify-content-between">
                      
                            <div class="btn-group">
                                <button id="btnGroupDrop1" type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false">
                                    <i class="fa fa-globe"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item" href="#"><i class="fa fa-globe"></i> Public</a>
                                    <a class="dropdown-item" href="#"><i class="fa fa-users"></i> Friends</a>
                                    <a class="dropdown-item" href="#"><i class="fa fa-user"></i> Just me</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Post /////-->

                <!--- \\\\\\\Post--> 
                <div id="allposts">

                </div>

                <!---POST---->
                <div class="card gedf-card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="mr-2">
                                    <img class="rounded-circle" width="45" src="https://picsum.photos/50/50" alt="">
                                </div>
                                <div class="ml-2">
                                    <div class="h5 m-0">@USERNAME</div>
                                    <div class="h7 text-muted">FULLNAME</div>
                                </div>
                            </div>
                            <div>
                                <div class="dropdown">
                                    <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-ellipsis-h"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1">
                                        <div class="h6 dropdown-header">Configuration</div>
                                        <a class="dropdown-item" href="#">Save</a>
                                        <a class="dropdown-item" href="#">Hide</a>
                                        <a class="dropdown-item" href="#">Report</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="text-muted h7 mb-2"> <i class="fa fa-clock-o"></i>TIME ELAPSED</div>
                        <a class="card-link" href="#">
                            <h5 class="card-title"> Lorem ipsum dolor sit amet consectetur adipisicing elit. Velit consectetur
                                deserunt illo esse distinctio.</h5>
                        </a>

                        <p class="card-text">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. Magnam omnis nihil, aliquam est, voluptates officiis iure soluta
                            alias vel odit, placeat reiciendis ut libero! Quas aliquid natus cumque quae repellendus. Lorem
                            ipsum dolor sit amet consectetur adipisicing elit. Ipsa, excepturi. Doloremque, reprehenderit!
                            Quos in maiores, soluta doloremque molestiae reiciendis libero expedita assumenda fuga quae.
                            Consectetur id molestias itaque facere? Hic!
                        </p>
                        <div>
                            <span class="badge badge-primary">JavaScript</span>
                            <span class="badge badge-primary">Android</span>
                            <span class="badge badge-primary">PHP</span>
                            <span class="badge badge-primary">Node.js</span>
                            <span class="badge badge-primary">Ruby</span>
                            <span class="badge badge-primary">Python</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a>
                        <a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a>
                        <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a>
                    </div>
                </div>
                <!-- Post /////-->

                <!--- \\\\\\\Post-->
                <div class="card gedf-card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="mr-2">
                                    <img class="rounded-circle" width="45" src="https://picsum.photos/50/50" alt="">
                                </div>
                                <div class="ml-2">
                                    <div class="h5 m-0">@LeeCross</div>
                                    <div class="h7 text-muted">Miracles Lee Cross</div>
                                </div>
                            </div>
                            <div>
                                <div class="dropdown">
                                    <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-ellipsis-h"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1">
                                        <div class="h6 dropdown-header">Configuration</div>
                                        <a class="dropdown-item" href="#">Save</a>
                                        <a class="dropdown-item" href="#">Hide</a>
                                        <a class="dropdown-item" href="#">Report</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="card-body">
                        <div class="text-muted h7 mb-2"> <i class="fa fa-clock-o"></i> Hace 40 min</div>
                        <a class="card-link" href="#">
                            <h5 class="card-title">Totam non adipisci hic! Possimus ducimus amet, dolores illo ipsum quos
                                cum.</h5>
                        </a>

                        <p class="card-text">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. Ipsam sunt fugit reprehenderit consectetur exercitationem odio,
                            quam nobis? Officiis, similique, harum voluptate, facilis voluptas pariatur dolorum tempora sapiente
                            eius maxime quaerat.
                            <a href="https://mega.nz/#!1J01nRIb!lMZ4B_DR2UWi9SRQK5TTzU1PmQpDtbZkMZjAIbv97hU" target="_blank">https://mega.nz/#!1J01nRIb!lMZ4B_DR2UWi9SRQK5TTzU1PmQpDtbZkMZjAIbv97hU</a>
                        </p>
                    </div>
                    <div class="card-footer">
                        <a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a>
                        <a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a>
                        <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a>
                    </div>

                </div>
                <!-- Post /////-->
            </div>   

			<!--Right Column-->
            <div class="col-md-3">
                <div class="card gedf-card">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                            card's content.</p>
                        <a href="#" class="card-link">Card link</a>
                        <a href="#" class="card-link">Another link</a>
                    </div>
                </div>
                <div class="card gedf-card">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                            card's content.</p>
                        <a href="#" class="card-link">Card link</a>
                        <a href="#" class="card-link">Another link</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    var postsOnClient = [];
    var commentsOnPosts = [];

    function initAllPosts() {
        // TODO: ACTUALLY DISPLAY POSTS ON THE HOME PAGE SOMEHOW
        // iterate through all of the posts
        console.log("initAllPosts called");
        var container = document.getElementById('allposts');
        <% posts.forEach(post => { %>
            var content = "<div class=\"card gedf-card\">" +
                        "<div class=\"card-header\">" +
                            "<div class=\"d-flex justify-content-between align-items-center\">" +
								"<div class=\"d-flex justify-content-between align-items-center\">" +
									"<div class=\"mr-2\">" +
										"<img class=\"rounded-circle\" width=\"45\" src=\"https://picsum.photos/50/50\">" +
                                    "</div>";
            <% if(post.friend) { %>
                content += "<div class=\"ml-2\">" +
                                "<div class=\"h5 m-0\">@<%=post.posterName%> posted on @<%=post.userName%>'s wall</div>" +
							"</div>";
            <%} else { %>
                content += "<div class=\"ml-2\">" +
                                "<div class=\"h5 m-0\">@<%=post.posterName%> </div>" +
							"</div>";
            <% } %>
			    content +=      "</div>" +
							"</div>" +
                        "</div>" +
                        "<div class=\"card-body\">" +
                            "<div class=\"text-muted h7 mb-2\"> <i class=\"fa fa-clock-o\"></i><%=post.timestamp%></div>" +
                            "<a class=\"card-link\" href=\"#\">" +
                                "<h5 class=\"card-title\"><%=post.postID%></h5>" +
                            "</a>" +
                            "<p class=\"card-text\"> <%=post.content%></p>" +
                         "</div>" +
                         "<div class=\"card-footer\">" + 
                            "<a href=\"#\" class=\"card-link\"><i class=\"fa fa-gittip\"></i> Like</a>" +
                            "<a href=\"#\" class=\"card-link\"><i class=\"fa fa-comment\"></i> Comment</a>" + 
                            "<a href=\"#\" class=\"card-link\"><i class=\"fa fa-mail-forward\"></i> Share</a>" +
                        "</div>" +
                        "<div class=\"card-body\">" +
                            "<div class=\"card-subtitle\">" +
                                "Comments" +
                            "</div>" +
                            "<form action=\"/commentonpost\" method=\"post\">" +
                                "<div class=\"form-group\">" +
                                    "<label class=\"sr-only\" for=\"message\">post</label>" +
                                    "<textarea class=\"form-control\" style=\"height:70px;\" name=\"commentContent\" rows=\"3\" placeholder=\"Leave a comment, <%=username%>!\" required></textarea>" +
                                    "<br>" +
                                    "<input type=\"submit\" value=\"Comment\" class=\"btn btn-lg btn-primary\">" +
                                " </div>" +
                            "</form>" +
                        " </div>" +
                    "</div> ";
            postsOnClient.push("<%=post%>");
            container.innerHTML += content;

        // TODO: HERE IS WHERE YOU SHOULD WRITE CODE THAT INITIALLY DISPLAYS EVERY POST

        // add each post from the server into the list of posts stored on the client side
        <% }); %>
        console.log(postsOnClient);
    }

    function initAllComments() {

    }

    function renderPostsAndComments() {

    }

    // TODO: ejs form submit button (for making a new post) should have: onclick="makeNewPost()"
    // makes a new post when the user submits the form for creating a post
    function makeNewPost() {
        // get the user's inputted fields
        var postContent = $('input[name="newPostContent"]').val();
        // TODO: get the timestamp that the user pressed the "post" button when they create a post
        var postTimestamp = Date.now();
        // TODO: get the hashtags from a user's post (if present)
        //var postHashtags = ...
        $.ajax({
            url: "/wall",
            type: "POST",
            data:
                {
                    content: postContent,
                    timestamp: postTimestamp,
                    hashtag: postHashtags
                },
            success: function(data) {
                // TODO: SHOW THE NEW POST ON THE USER'S HOME PAGE

                // add the new post to the list of posts on the client side
                //postsOnClient.push(theNewPost);
                // TODO: var theNewPost -> THIS MUST BE IN THE SAME FORM AS THE POSTS THAT RETURN FROM THE ARRAY OF POSTS SENT FROM THE DATABASE
            }
        })
    }

    // automatic refresh every 5 seconds to update home page
    var refreshTime = function() {
        // set clock to refresh every 5000 ms
        $("#clock").html((new Date()).toString());
        setTimeout(refreshTime, 5000);
        // make AJAX call to get the home page posts and compare the data from the server to the data on the client
        $.ajax({
                url: "/homepageposts",
                type: "GET",
                success: function(data) {
                    // list containing the differences between the server and client
                    var newPosts = [];
                        
                    // iterate through data (posts) sent from server
                    data.forEach(p => {
                        // put the post in the list if it's from the server but not on the client
                        if (!postsOnClient.includes(p)) {
                            newPosts.push(p);
                            // update the client-side list to contain new posts from the server
                            postsOnClient.push(p);
                        }
                    });
                        
                    // TODO: ACTUALLY DISPLAY THE NEW POSTS THAT THE SERVER HAS SENT TO THE CLIENT
                    newPosts.forEach(newPost => {
                        // SEE ABOVE
                    });
                },
                error: function(err) {
                    // TODO: HANDLE ERRORS WITH AJAX CALLING DATABASE
                    alert(err);
                }
            })
    };

    initAllComments();
    initAllPosts();

    $(document).ready(function() {
        // CAN CHANGE CSS CODE (THE LINE BELOW) IF THERE ARE CONFLICTS
        $("#clock").css("color", "white");
        setTimeout(refreshTime, 5000);
    });
</script>